<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Inpod Fans â€“ Registration Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg-gradient-from: #f9fafb;
      --bg-gradient-to:   #e5e7eb;
      --card-bg: #ffffff;
      --card-soft: #f9fafb;
      --accent:  #f97316;
      --accent-soft: #ffedd5;
      --accent-dark: #ea580c;
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --border-subtle: #e5e7eb;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(to bottom, var(--bg-gradient-from), var(--bg-gradient-to));
      min-height: 100vh;
      padding: 20px;
      color: var(--text-main);
    }
    .container { max-width: 1100px; margin: 0 auto; }

    h1 {
      font-size: 26px;
      margin-bottom: 6px;
      color: #0f172a;
    }
    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 18px 20px;
      margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.08);
      border: 1px solid var(--border-subtle);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .section-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #111827;
    }
    .section-title span.icon {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: var(--accent-soft);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
    }

    .pill {
      font-size: 11px;
      border-radius: 999px;
      padding: 4px 9px;
      background: #e5e7eb;
      color: #111827;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .stat-card {
      flex: 1;
      min-width: 150px;
      background: var(--card-soft);
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid var(--border-subtle);
    }
    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 3px;
    }
    .stat-value {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 2px;
    }
    .stat-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px;
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 8px 10px;
      text-align: left;
    }
    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-muted);
      background: #f3f4f6;
      border-bottom: 1px solid #e5e7eb;
    }
    td {
      font-size: 12px;
      color: #111827;
      border-bottom: 1px solid #e5e7eb;
    }
    tr:last-child td { border-bottom: none; }
    tr:nth-child(even) td { background: #f9fafb; }
    tr:nth-child(odd)  td { background: #ffffff; }

    .no-data {
      text-align: center;
      padding: 18px 0;
      font-size: 13px;
      color: #6b7280;
    }

    .error-box {
      padding: 8px 10px;
      border-radius: 10px;
      background: #fee2e2;
      color: #b91c1c;
      font-size: 12px;
      margin-bottom: 10px;
      display: none;
    }

    .loading {
      text-align: center;
      font-size: 13px;
      color: #6b7280;
      padding: 12px 0;
      display: none;
    }
    .loading .spinner {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid rgba(148,163,184,0.5);
      border-top-color: #f97316;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .footer {
      margin-top: 12px;
      text-align: center;
      font-size: 11px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Registration Dashboard</h1>
    <div class="subtitle">Overview of Inpod Fans warranty registrations.</div>

    <div id="error-box" class="error-box"></div>

    <div class="card">
      <div class="card-header">
        <div class="section-title">
          <span class="icon">ðŸ“Š</span>
          <span>Summary</span>
        </div>
        <div class="pill">
          <span class="dot"></span>
          <span id="summary-text">Loading...</span>
        </div>
      </div>

      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-label">Total Registered</div>
          <div class="stat-value" id="stat-total">0</div>
          <div class="stat-sub">All time</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Today</div>
          <div class="stat-value" id="stat-today">0</div>
          <div class="stat-sub" id="stat-today-date"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Last 7 days</div>
          <div class="stat-value" id="stat-7days">0</div>
          <div class="stat-sub">Recent trend</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Last 30 days</div>
          <div class="stat-value" id="stat-30days">0</div>
          <div class="stat-sub">Monthly activity</div>
        </div>
      </div>

      <div id="loading" class="loading">
        <div class="spinner"></div>
        Loading stats...
      </div>

      <h3 style="font-size:14px;margin-top:12px;margin-bottom:4px;">Registrations by Dealer</h3>
      <table>
        <thead>
          <tr>
            <th>Dealer</th>
            <th>Registered Count</th>
          </tr>
        </thead>
        <tbody id="dealer-body">
          <tr><td colspan="2" class="no-data">No data.</td></tr>
        </tbody>
      </table>

      <h3 style="font-size:14px;margin-top:12px;margin-bottom:4px;">Registrations by Day</h3>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Registrations</th>
          </tr>
        </thead>
        <tbody id="day-body">
          <tr><td colspan="2" class="no-data">No registrations yet.</td></tr>
        </tbody>
      </table>
    </div>

    <div class="footer">
      Inpod Fans Â· Internal registration dashboard
    </div>
  </div>

  <script>
    // ðŸ”§ TODO: replace with your deployed Apps Script Web App URL (/exec)
    const API_BASE =
      "https://script.google.com/macros/s/AKfycbyhC7ivoWvPm1hYo2VDr9mheEMBkmVFHrIHsxYpDNDH0KNkVNRvBN2DENMW4uWriymr/exec";

    function loadAdminStats() {
      const errorBox   = document.getElementById('error-box');
      const loading    = document.getElementById('loading');
      const dealerBody = document.getElementById('dealer-body');
      const dayBody    = document.getElementById('day-body');

      const statTotal   = document.getElementById('stat-total');
      const statToday   = document.getElementById('stat-today');
      const stat7       = document.getElementById('stat-7days');
      const stat30      = document.getElementById('stat-30days');
      const statTodayDt = document.getElementById('stat-today-date');
      const summaryText = document.getElementById('summary-text');

      errorBox.style.display = 'none';
      errorBox.textContent = '';
      loading.style.display = 'block';
      dealerBody.innerHTML = '';
      dayBody.innerHTML = '';

      fetch(`${API_BASE}?admin=1`)
        .then(r => r.json())
        .then(data => {
          loading.style.display = 'none';

          if (!data.success) {
            errorBox.textContent = data.msg || 'Failed to load stats.';
            errorBox.style.display = 'block';
            return;
          }

          const t = data.totals || {};
          statTotal.textContent = t.totalRegistered || 0;
          statToday.textContent = t.todayRegistered || 0;
          stat7.textContent     = t.last7Days || 0;
          stat30.textContent    = t.last30Days || 0;

          const today = new Date();
          const dd = String(today.getDate()).padStart(2,'0');
          const mm = String(today.getMonth()+1).padStart(2,'0');
          const yyyy = today.getFullYear();
          statTodayDt.textContent = `Today: ${dd}-${mm}-${yyyy}`;

          summaryText.textContent =
            `${t.totalRegistered || 0} total Â· ${t.todayRegistered || 0} today`;

          const byDealer = data.byDealer || [];
          if (!byDealer.length) {
            dealerBody.innerHTML =
              '<tr><td colspan="2" class="no-data">No dealer registrations yet.</td></tr>';
          } else {
            dealerBody.innerHTML = byDealer.map(d => `
              <tr>
                <td>${d.dealer || '-'}</td>
                <td>${d.count || 0}</td>
              </tr>
            `).join('');
          }

          const byDay = data.byDay || [];
          if (!byDay.length) {
            dayBody.innerHTML =
              '<tr><td colspan="2" class="no-data">No registrations yet.</td></tr>';
          } else {
            dayBody.innerHTML = byDay.map(r => `
              <tr>
                <td>${r.date || '-'}</td>
                <td>${r.count || 0}</td>
              </tr>
            `).join('');
          }
        })
        .catch(err => {
          console.error(err);
          loading.style.display = 'none';
          errorBox.textContent = 'Error loading stats: ' + err.message;
          errorBox.style.display = 'block';
        });
    }

    document.addEventListener('DOMContentLoaded', loadAdminStats);
  </script>
</body>
</html>
